##
##  $Header: /scm/cvs/src/common/Makegen,v 1.22 2003/04/16 21:54:57 andreas Exp $
##
##  This is the makegen file for the libraries shared between d2c and mindy.
##

# the order is significant, since the d2c libraries must be compiled in
# dependency order. 

# These libraries are needed to compile d2c. They must compile against the
# runtime that shipped with 2.2.0.
@pre_melange_libraries_needed_to_bootstrap =
    ('streams', 'standard-io', 'print', 'format', 'collection-extensions',
     'table-ext', 'string-ext', 'regular-expressions', 'format-out', 'matrix',
     'stream-ext', 'transcendental', 'getopt', 'base-file-system');
    #'internal-time'
@post_melange_libraries_needed_to_bootstrap =
    ('time');
    #'internal-time'

# These libraries have been introduced since 2.2.0. They may not be used by
# d2c, parsergen or any of the above libraries. Once common-dylan stabilizes,
# and most users can compile common-dylan programs, we'll drop backwards
# compatibility with 2.2.0 and port everything to build against these
# libraries.
@newer_libraries =
    ('threads', 'common-dylan', 'collections', 'io', 'file-system',
     'date', 'system', 'locators', 'network');

&compile_subdirs(@pre_melange_libraries_needed_to_bootstrap);
# Parsergen is needed to compile Melange
push(@compile_commands, 
   	sprintf($host_platform{'recursive_make_command'},
       	"../tools/parsergen", ""));
push(@dbc_only_commands, 
   	sprintf($host_platform{'recursive_make_command'},
       	"../tools/parsergen", ""));
# Melange is needed to compile the common libraries
push(@compile_commands,
    sprintf($host_platform{'recursive_make_command'},
        "../tools/melange", ""));
push(@dbc_only_commands,
    sprintf($host_platform{'recursive_make_command'},
        "../tools/melange", ""));
&compile_subdirs(@post_melange_libraries_needed_to_bootstrap);

unless ($enable_bootstrap) {
  &compile_subdirs(@newer_libraries);
  if($features{'compiled_for_unix'}) {
    &compile_subdirs('command-processor');
  }
}


