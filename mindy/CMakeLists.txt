INCLUDE(AddCCompilerFlag)
INCLUDE(CheckFunctionExists)
INCLUDE(CheckStructHasMember)
INCLUDE(CheckSymbolExists)
INCLUDE(CheckTypeSize)

CHECK_FUNCTION_EXISTS(_setjmp HAVE__SETJMP)
CHECK_FUNCTION_EXISTS(_longjmp HAVE__LONGJMP)

CHECK_STRUCT_HAS_MEMBER("struct tm" tm_gmtoff time.h HAVE_TM_GMTOFF)

CHECK_SYMBOL_EXISTS(daylight time.h HAVE_DAYLIGHT)

CHECK_TYPE_SIZE("void*" SIZEOF_VOID_P)

ADD_DEFINITIONS(-DBINDIR="/opt/mindy/bin")
ADD_DEFINITIONS(-DLIBDIR="/opt/mindy/lib/dylan")
ADD_DEFINITIONS(-DTARGET="x86_64-darwin-gcc")
ADD_DEFINITIONS(-DVERSION="${MINDY_VERSION_STRING}")

ADD_C_COMPILER_FLAG(-Wall)

# clang doesn't print colored diagnostics when invoked from Ninja
IF (UNIX AND
    CMAKE_C_COMPILER_ID STREQUAL "Clang" AND
    CMAKE_GENERATOR STREQUAL "Ninja")
  SET(CMAKE_C_FLAGS "-fcolor-diagnostics ${CMAKE_C_FLAGS}")
ENDIF()

SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${PROJECT_BINARY_DIR}/bin")

CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/config.h.cmake
               ${CMAKE_CURRENT_BINARY_DIR}/config.h)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR})

ADD_SUBDIRECTORY(compiler)
ADD_SUBDIRECTORY(exec)
ADD_SUBDIRECTORY(interpreter)
